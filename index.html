<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,user-scalable=0">
		<link rel="shortcut icon" type="image/x-icon" href="https://admin.roya.com/views/assets/app-icons/roya/favicon-32x32.png">
		<title>Brands V3 </title>
		<meta name="description" content="Eye Care <span>Optical Clinic</span> provides the highest quality of optometry care services in San Diego, CA and the nearby communities. Call (123) 456-7890 today!">
		<meta name="keywords" content="">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/css/bootstrap.min.css" rel="stylesheet" type="text/css">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/css/common-global.css" rel="stylesheet" type="text/css">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/css/site-overrides.css?jxl141305588=jxl141305588" rel="stylesheet" type="text/css">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/css/pages/WebPage-ac5a47cc-f75f-4e72-b1b9-8d40e9bbf485.css?jxl141305588=jxl141305588" rel="stylesheet" type="text/css">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/styles/default.css" rel="stylesheet">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/styles/site.css" rel="stylesheet">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/styles/color_scheme_1.css" rel="stylesheet">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/styles/overrides.css" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <style>
      body, html, body div, body p, body .search-result, body .description, .ry-form label, .ry-table .ry-row .ry-td:first-child .ry-lbl, .ry-list-wrp .ry-list-item .ry-list-content .ry-list-excerpt, #menu_container .mm-listview .mob-menu a, .mm-panel .mob-menu a {
        font-family: Inter !important;
      }
      #ProgressLoading {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: #f1f1f1;
    z-index: 1000;
}

#loadingProgress {
    width: 100%;
    height: 10px;
}

#progressText {
    display: block;
    text-align: center;
    font-size: 14px;
    margin-top: 5px;
}


#ProgressLoading {
    position: fixed;
    top: 65%;
    transform: translate(0, -50%);
    z-index: 999999;
    background: transparent;
}

#ProgressLoading #progressText {
    text-align: center;
    color: #000;
    font-size: 50px;
    margin: 0;
}

#loadingProgress {
    opacity: 0;
    height: 0;
}

body:not(.activated):after {
    background-image: url(https://s3.amazonaws.com/static.organiclead.com/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/waitgif.gif);
    width: 200px;
    height: 153px;
    transition: .3s;
}

body.progress-20:not(.activated):after {
    background-image: url(https://s3.amazonaws.com/static.organiclead.com/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/cute_25.gif);
    height: 200px;
    width: 188px;
}

body.progress-40:not(.activated):after {
    background-image: url(https://s3.amazonaws.com/static.organiclead.com/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/cute_50gif.gif);
    width: 200px;
    height: 200px;
}
body.progress-60:not(.activated):after {
    background-image: url(https://s3.amazonaws.com/static.organiclead.com/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/80cat.gif);
    width: 250px;
    height: 227px;
}

body.progress-80:not(.activated):after {
  background-image: url(https://s3.amazonaws.com/static.organiclead.com/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/cute_dancing.gif);
    width: 250px;
    height: 220px;
    background-size: cover;
}
body.progress-90:not(.activated):after {
    background-image: url(https://s3.amazonaws.com/static.organiclead.com/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/cute_dancing.gif);
    width: 250px;
    height: 220px;
    background-size: cover;
}

.brand-box-container.animated-wait:before, 
.brand-box-container.animated-wait:after {
    display: none;
}

    </style>
		</head>

	<body class="default" id="brandDefault">
    
    <div id="ProgressLoading">
      <progress id="loadingProgress" value="0" max="100"></progress>
      <span id="progressText">0%</span>
  </div>
		<div class="site-content">
		<div id="ry-pg-body" class="col-xs-12 ">
  <div class="col-xs-12 ry-container">
    <div class="col-xs-12 ry-content">
      <div id="brands" class="col-xs-12 brands">
        <div class="filter-group">
          <div class="button-wrapper">
            <a href="javascript:void(0)" data-target="#Contact-Lens-Brand" class="ry-btn ry-btn-primary active" data-folderlocation="_Contact Lens Brand">Brand Logo</a>
            <a href="javascript:void(0)" data-target="#Brand-Images-Isolated" class="ry-btn ry-btn-primary" data-folderlocation="_Brand Images Isolated">Brand with Frame</a>
            <a href="javascript:void(0)" data-target="#Brand-Images-with-Model" class="ry-btn ry-btn-primary" data-folderlocation="_Brand Images with Model">Brand with Model</a>
            <a href="javascript:void(0)" data-target="#Frame-Brands" class="ry-btn ry-btn-primary" data-folderlocation="_Frame Brands">Frame Logo</a>
            <a href="javascript:void(0)" data-target="#Payment-Options" class="ry-btn ry-btn-primary" data-folderlocation="_Payment Options">Payment Logo</a>
          </div>
          <div class="search-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
              <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"></path>
            </svg>
            <input name="SearchData" class="search" placeholder="Search Brand Logo Here!">
          </div>
        </div>
        <div class="col-xs-12 brand-container">
          <div class="col-xs-12 ry-flex">
            <div class="col-xs-12 col-lg-3 ry-each brand-text">
              <div class="ry-text">
                <p>You Selected <br>
                  <b>
                    <span class="count">0</span> Logos </b> from the list.
                </p>
                <div onclick="generateZIP()" class="download button-download">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
                    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"></path>
                    <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"></path>
                  </svg>Download now
                </div>
                <a href="javascript:void(0);" class="clear-all-check" style="display: none;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                    <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"></path>
                  </svg> clear all </a>
              </div>
            </div>
            <div class="col-xs-12 col-lg-9 ry-each brand-list">
              <div id="Contact-Lens-Brand" class="col-xs-12 brand-box-container loaded active" data-folder="_Contact Lens Brand">
                <div class="button-hidden hidden">
                  <button type="submit" class="btn btn-primary">Zip them</button>
                  <div class="progress d-none">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                </div>
                <div class="hidden">
                  <div class="progress hide" id="progress_bar">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                  <p class="hide" id="result"></p>
                </div>
                
              </div>
              <div id="Brand-Images-Isolated" class="col-xs-12 brand-box-container loaded animated-wait " data-folder="_Brand Images Isolated">
                <div class="button-hidden hidden">
                  <button type="submit" class="btn btn-primary">Zip them</button>
                  <div class="progress d-none">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                </div>
                <div class="hidden">
                  <div class="progress hide" id="progress_bar">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                  <p class="hide" id="result"></p>
                </div>
                
              </div>
              <div id="Brand-Images-with-Model" class="col-xs-12 brand-box-container loaded animated-wait" data-folder="_Brand Images with Model">
                <div class="button-hidden hidden">
                  <button type="submit" class="btn btn-primary">Zip them</button>
                  <div class="progress d-none">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                </div>
                <div class="hidden">
                  <div class="progress hide" id="progress_bar">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                  <p class="hide" id="result"></p>
                </div>
                
              </div>
              <div id="Frame-Brands" class="col-xs-12 brand-box-container loaded animated-wait" data-folder="_Frame Brands">
                <div class="button-hidden hidden">
                  <button type="submit" class="btn btn-primary">Zip them</button>
                  <div class="progress d-none">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                </div>
                <div class="hidden">
                  <div class="progress hide" id="progress_bar">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                  <p class="hide" id="result"></p>
                </div>
                
              </div>
              <div id="Payment-Options" class="col-xs-12 brand-box-container loaded animated-wait" data-folder="_Payment Options">
                <div class="button-hidden hidden">
                  <button type="submit" class="btn btn-primary">Zip them</button>
                  <div class="progress d-none">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                </div>
                <div class="hidden">
                  <div class="progress hide" id="progress_bar">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                  <p class="hide" id="result"></p>
                </div>
                
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    </div>
  </div>
</div>


	
		<script type="text/javascript" src="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/js/common.js?jxl1898761698=jxl1898761698"></script>
		<!-- Script Injections -->
        <script src="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/scripts/dependencies.js"></script>
        <script src="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/scripts/jszip.js"></script>
        <script src="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/scripts/jszip-utils.js"></script>
        <script src="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/scripts/filesaver.js"></script>

        <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.js"></script>

        <script>
            $(function () {
                $(document).on('click', '.text-copy', function () {
                    var copiedtext = $(this).text();
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(copiedtext)
                        .then(() => {
                            $(this).prev(".copied-toast").text("Copied!").show().fadeOut(1200);
                            setTimeout(() => {
                                $(this).prev(".copied-toast").text("Copy Image Url");
                            }, 1500);
                        })
                        .catch(() => {
                            $(this).prev(".copied-toast").text("Copy Image Url").show().fadeOut(1200);
                        });
                    } else {
                        $(this).prev(".copied-toast").text("Copy Image Url").show().fadeOut(1200);
                    }
                });

                $(document).on('mouseenter', '.copy-clip', function() {
                    $(this).find(".copied-toast").show();
                    $(this).parents('.each-brand').find('.brand-image-hover').addClass('svg_active');
                }).on('mouseleave', '.copy-clip', function() {
                    $(this).find(".copied-toast").hide();
                    $(this).parents('.each-brand').find('.brand-image-hover').removeClass('svg_active');
                });
            });
        </script>

		<script src="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/scripts/lazyimages.js"></script>
		

    <script>
      const imageCache = {};
      const CLIENT_ID = '66iobk6ar1c2aap';
      const CLIENT_SECRET = '0bq7obz28la0veh';
      const REFRESH_TOKEN = 'R2ipmLbhqEkAAAAAAAAAAW307lbz-YT0aYSLfF9ftjQwv5KoogK3Rq_S2rPohMGA';
      const TOKEN_STORAGE_KEY = 'sl.u.AFgxYp5-VXUEuAlgaDnj91wwtNnCFRxb8p4jlxuVnJmeTGWt9sYa7KNzP1BRsE3S7hOtqPpNb3OAGiXtpyzZwItVmTyioTuF63RhYelp7I8pTWUQYt-_gptg4WjCfIIHPrkm01SMSD61Y-rixT73mJgJQmiIaZtxx4dOB2veJOLJVROhoqhzdsMBW5hEupOXQgOh1SU_sq6KmgNmrDR9-WWFsOGKUX79UKJUnSveCJa1ATcecQnU7tMo71LEB2zzz52FXmseUQUYBmAWUtP17Nvtc2s9RAYe0iQCdPgjbVCCmw-7Dg4yn3OwZt9JhaJrfg57jFN7YtBw75IDBDNdMbtGMHI6ANpSnC8bAJhd6cAEH3FfK8HEqp-EYJATipKW-7Fe2saTXc1ejmzmw2othzApo8H9kZSTUXTl92P5cPFCi0DeHFivhBBUZOp2TIDiXBYAg0NwKfqdHGhuWafKJyEJ6jpKPmQ8TzCcAbDi1ky8Sa6S4evIii-rjnkygU-oPZJBNQB5IYqkRpUwFKcLbQHkhmA47nvp0K7bRX01r3MN-6_B9du5HXK9m-lpkqB3JQILuDOQStQ3v2dI_QpzmQNBSpwHznc2Yp1hDGxSqldJQ9qjloTrO8lNewTO0nRkcyuoxyt0yLHRVuZLfuVEFH7RJj05lX2QDi85HUaqRU0FdLzKwpGMUAjOio5ShdyI-Qk_BNjcX_qATXgJoeCm1cRSAv2WUlP-KZBkLv1-cGzodn91yNq5fSR8V40pJDMAlVl46X10nC6CfuOBOqDbUgEhqQCgobwmVpDOqJR0bY8SjdX5QxqwllRSlxQzsMPo8dGf6X7Ur7SgAgB1D7P8T3VuHkcKg_et4iuwPDtewvSazzUG2B4FrQsAGag41tbDF4f9ESaGe2ElhiVeHwykrhYguwdM7WgmtqMwVI6oMeTVIFDoP3WZT0DQX49yayeFGP8A-M23wkhcdSm5kGps2r2Jsn7fEIdu6Wtkn26bwjawD3xVh0Z18I7QPYtkCPvqQr8zmFFeUWv-aKQaLqT95hzDo_bpU3rRK8YUspVHGZlOg5ZgIsza2uRSeDqhHBo_o9LRRRGQ-jUTv4Xl4TTuytrp_e39PeoTrzDnEINn0R0NeoL9r_S_onVt-l_88KJw0vx4716GG2Qo9JwYXDw031pV7tkSiEZPM2J5bHhSTj71KMfyF1l2pCGM9n65RG17adTqq2swY0Hh6YndBLBn176ecl28fZ4UOun9kpd65pgwADJug8ntS4wCjnpiyXnZDB0udCKju5TO-fCAIes4AE-OhTEo_07AY9W5bU9gv9LhA2MAH2De9FEJK655WTVa6Z497ZXPWx_RfknU5JxN_IKoNh6eVwTuuhC2ZweSt0gdIw';
  
      async function getAccessToken() {
        const storedToken = localStorage.getItem(TOKEN_STORAGE_KEY);
        if (storedToken) {
            return storedToken;
        }

        const url = 'https://api.dropbox.com/oauth2/token';
        const params = new URLSearchParams();
        params.append('grant_type', 'refresh_token');
        params.append('refresh_token', REFRESH_TOKEN);
        params.append('client_id', CLIENT_ID);
        params.append('client_secret', CLIENT_SECRET);

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: params
            });

            if (!response.ok) {
                throw new Error('Failed to refresh token');
            }

            const data = await response.json();
            localStorage.setItem(TOKEN_STORAGE_KEY, data.access_token);
            return data.access_token;
        } catch (error) {
            console.error('Error refreshing token:', error);
            return null;
        }
    }
  
    const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));
  
    async function fetchFilesWithPagination(folderPath) {
        let hasMore = true;
        let cursor = null;
        let allFiles = [];

        try {
            const ACCESS_TOKEN = await getAccessToken();

            while (hasMore) {
                const response = await fetch(`https://api.dropboxapi.com/2/files/list_folder${cursor ? '/continue' : ''}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${ACCESS_TOKEN}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(cursor ? { cursor } : { path: folderPath, limit: 200 }),
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        console.warn('Access token expired, refreshing token...');
                        localStorage.removeItem(TOKEN_STORAGE_KEY);
                        return fetchFilesWithPagination(folderPath);
                    }
                    throw new Error(`Error: ${response.statusText}`);
                }

                const data = await response.json();
                allFiles = allFiles.concat(data.entries);
                hasMore = data.has_more;
                cursor = data.cursor;
                await delay(100);
            }

            return allFiles;
        } catch (error) {
            console.error('Error fetching files with pagination:', error);
            throw error;
        }
    }
  
    const fetchTemporaryLinks = async (files, batchSize = 100) => {
      let allFilesWithUrls = [];
      for (let i = 0; i < files.length; i += batchSize) {
          const batch = files.slice(i, i + batchSize);
          const filePromises = batch.map(async file => {
              try {
                  const ACCESS_TOKEN = await getAccessToken();
                  const tempLinkResponse = await fetch('https://api.dropboxapi.com/2/files/get_temporary_link', {
                      method: 'POST',
                      headers: {
                          'Authorization': `Bearer ${ACCESS_TOKEN}`,
                          'Content-Type': 'application/json',
                      },
                      body: JSON.stringify({ path: file.path_display }),
                  });

                  if (!tempLinkResponse.ok) {
                      if (tempLinkResponse.status === 429) {
                          const retryAfter = parseInt(tempLinkResponse.headers.get('Retry-After')) || 1000;
                          console.log(`Rate limit hit. Retrying after ${retryAfter}ms`);
                          await delay(retryAfter);
                          return null;
                      }
                      throw new Error(`Error: ${tempLinkResponse.statusText}`);
                  }

                  const tempLinkData = await tempLinkResponse.json();
                  return { ...file, url: tempLinkData.link };
              } catch (error) {
                  console.error('Error fetching temporary link:', error);
                  return null;
              }
          });

          const batchWithUrls = await Promise.all(filePromises);
          allFilesWithUrls = allFilesWithUrls.concat(batchWithUrls.filter(Boolean));

          await delay(100);
      }
      return allFilesWithUrls;
    };
  
    const renderFiles = (filesWithUrls, targetDiv) => {
      targetDiv.innerHTML = '';

      filesWithUrls.forEach(file => {
          const divContent = document.createElement('div');
          divContent.classList.add('each-brand');
          divContent.innerHTML = `
              <div class="brand-image-hover">
                  <img class="lazyload" src="${file.url}" data-img="${file.url}">
              </div>
              <div class="brand-form">
                  <input type="checkbox" name="brand" value="${file.name}" data-url="${file.url}">
                  <input type="hidden" class="data-storage" value="${file.url}" data-name="${file.name}" data-logo="${file.url}">
                  <p class="name">${file.name}</p>
                  <div class="copy-clip" data-link="${file.url}">
                      <div class="copied-toast">Copy Image Url</div>
                      <span class="text-copy">${file.url}</span>
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"></path><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z"></path></svg>
                  </div>
              </div>`;

          targetDiv.appendChild(divContent);
      });

      console.log('Images rendered in:', targetDiv);
    };
  
    const loadAllImages = async () => {
    try {
        const ACCESS_TOKEN = await getAccessToken();
        const rootFolderPath = '/_Raw Logo'; // Root folder containing all subfolders

        // Fetch all folders inside the root folder
        const folders = await fetchFilesWithPagination(rootFolderPath);
        const imageFolders = folders.filter(entry => entry['.tag'] === 'folder');

        console.log(`Total folders found: ${imageFolders.length}`); // Debugging

        // Initialize progress bar, progress text, and #brandDefault
        const progressBar = document.getElementById('loadingProgress');
        const progressText = document.getElementById('progressText');
        const brandDefault = document.getElementById('brandDefault');

        // Total number of folders to process
        const totalFolders = imageFolders.length;
        let completedFolders = 0;

        // Iterate through each folder and fetch images
        for (const folder of imageFolders) {
            const folderPath = folder.path_display;
            const targetDiv = document.querySelector(`div[data-folder="${folder.name}"]`); // Use folder name as target div ID

            if (!targetDiv) {
                console.warn(`Target div not found for folder: ${folder.name}`); // Debugging
                continue;
            }

            console.log(`Processing folder: ${folder.name}`); // Debugging

            const allFiles = await fetchFilesWithPagination(folderPath);
            const imageFiles = allFiles.filter(entry => entry['.tag'] === 'file' && entry.name.match(/\.(jpg|jpeg|png|gif)$/i));
            const filesWithUrls = await fetchTemporaryLinks(imageFiles);

            renderFiles(filesWithUrls, targetDiv);
            completedFolders++;

            console.log(`Completed folder: ${folder.name} (${completedFolders}/${totalFolders})`); // Debugging

            // Update progress bar and text based on completed folders
            const progress = Math.round((completedFolders / 5) * 100);
            progressBar.value = progress;
            progressText.textContent = `${progress}%`;

            console.log(`Progress: ${progress}%`); // Debugging

            // Update brandDefault class based on progress
            if (progress > 1 && progress <= 20) {
                brandDefault.className = 'progress-20';
            } else if (progress > 20 && progress <= 40) {
                brandDefault.className = 'progress-40';
            } else if (progress > 40 && progress <= 60) {
                brandDefault.className = 'progress-60';
            } else if (progress > 60 && progress <= 80) {
                brandDefault.className = 'progress-80';
            } else if (progress > 80 && progress <= 90) {
                brandDefault.className = 'progress-90';
            } else if (progress > 90 && progress <= 100) {
                brandDefault.className = 'progress-90';
            }
        }

        console.log('All folders processed.'); // Debugging

        // Process brands after all folders are completed
        processBrands();

        
        
        
    } catch (error) {
        console.error('Error loading all images:', error);
    }
};

// Function to process brands after images are loaded
const processBrands = () => {
    const removeNumberPrefixAndCapitalize = (text) => {
        let cleanedText = text.replace(/^\d+[-_]?/, '');
        return cleanedText.charAt(0).toUpperCase() + cleanedText.slice(1);
    };

    document.querySelectorAll('.brand-box-container .each-brand').forEach(brandElement => {
        const brandTextElement = brandElement.querySelector('p');
        const brandCheckbox = brandElement.querySelector('input[type="checkbox"]');
        const cleanedText = removeNumberPrefixAndCapitalize(brandTextElement.textContent);
        const cleanedTextName = removeNumberPrefixAndCapitalize(brandCheckbox.value);

        brandTextElement.textContent = cleanedText;
        brandCheckbox.value = cleanedTextName;

        const letter = cleanedText.charAt(0);
        const parentElement = brandElement.parentElement;

        if (!parentElement.querySelector(`[data-letter="${letter}"]`)) {
            const brandLetterGroup = document.createElement('div');
            brandLetterGroup.setAttribute('data-count', letter);
            brandLetterGroup.className = 'brand-letter-group';
            brandLetterGroup.innerHTML = `<span class="headline-letter">${letter}</span><ul class="list" data-letter="${letter}"></ul>`;
            parentElement.appendChild(brandLetterGroup);

            // Sort brand groups alphabetically
            const groups = Array.from(parentElement.querySelectorAll('.brand-letter-group'));
            groups.sort((a, b) => a.dataset.count.localeCompare(b.dataset.count));
            groups.forEach(group => parentElement.appendChild(group));
        }

        const letterList = parentElement.querySelector(`[data-letter="${letter}"]`);
        letterList.appendChild(brandElement);
    });

    document.querySelectorAll('.brand-box-container .list .each-brand').forEach(brandElement => {
        const listItem = document.createElement('li');
        brandElement.parentNode.insertBefore(listItem, brandElement);
        listItem.appendChild(brandElement);
    });

    document.querySelectorAll(".copied-toast").forEach(toast => toast.style.display = 'none');

    initIsotope(); // Initialize Isotope after rendering

    document.querySelectorAll('.brand-box-container input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
    document.querySelector('.clear-all-check').style.display = 'none';
    document.querySelector('.brand-container .ry-flex .brand-text .count').textContent = '0';
    document.querySelector('.download.button-download').classList.add('disabled');
    
    // Hide the progress loader
    setTimeout(function () {
      document.body.classList.add('activated');
      document.getElementById('ProgressLoading').style.display = 'none'; 
    }, 1500);
    
};

// Load all images on page load
document.addEventListener('DOMContentLoaded', () => {
    loadAllImages();
    
});


    

      document.querySelectorAll('.button-wrapper .ry-btn-primary').forEach(button => {
        button.addEventListener('click', async () => {
            
            const target = button.getAttribute('data-target');
            //const folderLocation = button.getAttribute('data-folderlocation');
            const targetDiv = document.querySelector(target);
   
            document.querySelectorAll('.button-wrapper .ry-btn-primary').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            document.querySelectorAll('.brand-box-container').forEach(container => container.classList.remove('active'));
            targetDiv.classList.add('active');
            
            //await loadImagesForFolder(folderLocation, targetDiv);
            targetDiv.classList.remove('animated-wait');
            
          

            $('.brand-box-container input[type="checkbox"]').prop('checked', false);
            $('.clear-all-check').hide();
            $('.brand-container .ry-flex .brand-text .count').text('0');
            $('.download.button-download').addClass('disabled');

            links = [];

            initIsotope(); 
        });
      });

            
  </script>


<script>
var qsRegex;
    var $grid;


  // Function to initialize Isotope
  function initIsotope() {
    $grid = $('.brand-letter-group .list').isotope({
      itemSelector: 'li',
      layoutMode: 'fitRows',
      filter: function () {
        return qsRegex ? $(this).text().match(qsRegex) : true;
      }
    });

  }

  // Function to update filter
  function updateFilter() {
    qsRegex = new RegExp($('.search').val(), 'gi');
    $grid.isotope();

    setTimeout(function () {
      $('.brand-letter-group').each(function () {
        var finder = $(this).find('ul li:visible').length;
        $(this).attr('data-count', finder);
        setTimeout(function () {
          $grid.isotope();
        }, 100);
      });
    }, 150);
  }

  // Debounce function
  function debounce(fn, threshold) {
    var timeout;
    threshold = threshold || 100;
    return function debounced() {
      clearTimeout(timeout);
      var args = arguments;
      var _this = this;
      function delayed() {
        fn.apply(_this, args);
      }
      timeout = setTimeout(delayed, threshold);
    };
  }

  // Wait for the DOM to be ready
  $(document).ready(function () {
    //setTimeout(initIsotope, 1000);

    // Search input event
    $('.search').on('keyup', debounce(updateFilter, 100));

    // MutationObserver to detect dynamically added elements
    var observer = new MutationObserver(function (mutations) {
      mutations.forEach(function (mutation) {
        if (mutation.addedNodes.length) {
          $grid.isotope('reloadItems').isotope();
        }
      });
    });

    var targetNode = document.querySelector('.brand-letter-group');
    if (targetNode) {
      observer.observe(targetNode, { childList: true, subtree: true });
    }
  });

  var links = [];
    $(function () {
    
    $('.brand-box-container .each-brand').hover(function() {
        var img__hover = $(this).find('input[type="checkbox"]').attr('data-url');
        console.log(img__hover);
        $(this).find('.brand-image-hover img').attr('src', img__hover);
    });

    $('.download.button-download').addClass('disabled');
    $(document).on('click', '.brand-box-container input[type="checkbox"]', function () {
        if ($(this).is(':checked')) {
            $(this).removeClass().addClass('thumbChecked');
          links.push({
  url: $(this).data('url'),
  value: $(this).val()
});
            if (links.length !== 0) {
                $('.download').removeClass('download-disable');
            } else {
                $('.download').addClass('download-disable');
            }
            console.log(links);
        } else {
            $(this).removeClass().addClass('thumb');

            var itemtoRemove = $(this).attr('data-url');
            links.splice($.inArray(itemtoRemove, links), 1);
            console.log(links);

            if (links.length == 0) {
                $('.download').addClass('download-disable');
            }
        }

        var countData = links.length;
        $('.brand-container .ry-flex .brand-text .count').text(countData);

        if (countData >= 1) { 
            $('.clear-all-check').show();
            $('.download.button-download').removeClass('disabled');
        } else {
            $('.clear-all-check').hide();
            $('.download.button-download').addClass('disabled');
        }
    });

    $('.clear-all-check').click(function() {
        $('.brand-box-container input[type="checkbox"]').prop('checked', false);
        $('.clear-all-check').hide();
        $('.brand-container .ry-flex .brand-text .count').text('0');
        $('.download.button-download').addClass('disabled');
        links = [];
    });
    $( window ).scroll(function() {
      var height = $(window).scrollTop();

      if(height  > 300) {

        $('.brands .filter-group').addClass('fixed');
        $('.brand-container').addClass('fixed');

      }else{

        $('.brands .filter-group').removeClass('fixed');
        $('.brand-container').removeClass('fixed');
      }

    });
  });



  function generateZIP() {
    console.log('TEST');
    var zip = new JSZip();
    var count = 0;
    var zipFilename = "Pictures.zip";

    links.forEach(function (item, index) {
        var url = item.url;
        var value = item.value; 
        var filename = value;

        JSZipUtils.getBinaryContent(url, function (err, data) {
            if (err) {
                console.error("Error downloading:", url, err);
                return;
            }

            zip.file(filename, data, { binary: true });
            count++;  
            if (count === links.length) {
                zip.generateAsync({ type: 'blob' }).then(function (content) {
                    saveAs(content, zipFilename);
                });
            }
        });
    });
}


</script>
	</body>
</html>
