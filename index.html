<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,user-scalable=0">
		<link rel="shortcut icon" type="image/x-icon" href="https://admin.roya.com/views/assets/app-icons/roya/favicon-32x32.png">
		<title>Brands V3 </title>
		<meta name="description" content="Eye Care <span>Optical Clinic</span> provides the highest quality of optometry care services in San Diego, CA and the nearby communities. Call (123) 456-7890 today!">
		<meta name="keywords" content="">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/css/bootstrap.min.css" rel="stylesheet" type="text/css">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/css/common-global.css" rel="stylesheet" type="text/css">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/css/site-overrides.css?jxl141305588=jxl141305588" rel="stylesheet" type="text/css">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/css/pages/WebPage-ac5a47cc-f75f-4e72-b1b9-8d40e9bbf485.css?jxl141305588=jxl141305588" rel="stylesheet" type="text/css">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/styles/default.css" rel="stylesheet">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/styles/site.css" rel="stylesheet">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/styles/color_scheme_1.css" rel="stylesheet">
		<link href="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/styles/overrides.css" rel="stylesheet">
		</head>

	<body class="default">
		<div class="site-content">


		<div id="ry-pg-body" class="col-xs-12 ">
  <div class="col-xs-12 ry-container">
    <div class="col-xs-12 ry-content">
      <div id="brands" class="col-xs-12 brands">
        <div class="filter-group">
          <div class="button-wrapper">
            <a href="javascript:void(0)" data-target="#Contact-Lens-Brand" class="ry-btn ry-btn-primary active" data-folderlocation="_Contact Lens Brand">Brand Logo</a>
            <a href="javascript:void(0)" data-target="#Brand-Images-Isolated" class="ry-btn ry-btn-primary" data-folderlocation="_Brand Images Isolated">Brand with Frame</a>
            <a href="javascript:void(0)" data-target="#Brand-Images-with-Model" class="ry-btn ry-btn-primary" data-folderlocation="_Brand Images with Model">Brand with Model</a>
            <a href="javascript:void(0)" data-target="#Frame-Brands" class="ry-btn ry-btn-primary" data-folderlocation="_Frame Brands">Frame Logo</a>
            <a href="javascript:void(0)" data-target="#Payment-Options" class="ry-btn ry-btn-primary" data-folderlocation="_Payment Options">Payment Logo</a>
          </div>
          <div class="search-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
              <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"></path>
            </svg>
            <input name="SearchData" class="search" placeholder="Search Brand Logo Here!">
          </div>
        </div>
        <div class="col-xs-12 brand-container">
          <div class="col-xs-12 ry-flex">
            <div class="col-xs-12 col-lg-3 ry-each brand-text">
              <div class="ry-text">
                <p>You Selected <br>
                  <b>
                    <span class="count">0</span> Logos </b> from the list.
                </p>
                <div onclick="generateZIP()" class="download button-download">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
                    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"></path>
                    <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"></path>
                  </svg>Download now
                </div>
                <a href="javascript:void(0);" class="clear-all-check" style="display: none;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                    <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"></path>
                  </svg> clear all </a>
              </div>
            </div>
            <div class="col-xs-12 col-lg-9 ry-each brand-list">
              <div id="Contact-Lens-Brand" class="col-xs-12 brand-box-container loaded animated-wait" data-folder="_Contact Lens Brand">
                <div class="button-hidden hidden">
                  <button type="submit" class="btn btn-primary">Zip them</button>
                  <div class="progress d-none">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                </div>
                <div class="hidden">
                  <div class="progress hide" id="progress_bar">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                  <p class="hide" id="result"></p>
                </div>
                
              </div>
              <div id="Brand-Images-Isolated" class="col-xs-12 brand-box-container loaded animated-wait" data-folder="_Brand Images Isolated">
                <div class="button-hidden hidden">
                  <button type="submit" class="btn btn-primary">Zip them</button>
                  <div class="progress d-none">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                </div>
                <div class="hidden">
                  <div class="progress hide" id="progress_bar">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                  <p class="hide" id="result"></p>
                </div>
                
              </div>
              <div id="Brand-Images-with-Model" class="col-xs-12 brand-box-container loaded animated-wait" data-folder="_Brand Images with Model">
                <div class="button-hidden hidden">
                  <button type="submit" class="btn btn-primary">Zip them</button>
                  <div class="progress d-none">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                </div>
                <div class="hidden">
                  <div class="progress hide" id="progress_bar">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                  <p class="hide" id="result"></p>
                </div>
                
              </div>
              <div id="Frame-Brands" class="col-xs-12 brand-box-container loaded animated-wait" data-folder="_Frame Brands">
                <div class="button-hidden hidden">
                  <button type="submit" class="btn btn-primary">Zip them</button>
                  <div class="progress d-none">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                </div>
                <div class="hidden">
                  <div class="progress hide" id="progress_bar">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                  <p class="hide" id="result"></p>
                </div>
                
              </div>
              <div id="Payment-Options" class="col-xs-12 brand-box-container loaded animated-wait" data-folder="_Payment Options">
                <div class="button-hidden hidden">
                  <button type="submit" class="btn btn-primary">Zip them</button>
                  <div class="progress d-none">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                </div>
                <div class="hidden">
                  <div class="progress hide" id="progress_bar">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                  </div>
                  <p class="hide" id="result"></p>
                </div>
                
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    </div>
  </div>
</div>


	
		<script type="text/javascript" src="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/js/common.js?jxl1898761698=jxl1898761698"></script>
		<!-- Script Injections -->
        <script src="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/scripts/dependencies.js"></script>
        <script src="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/scripts/jszip.js"></script>
        <script src="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/scripts/jszip-utils.js"></script>
        <script src="https://admin.roya.com/sites/Site-b0ac8594-8528-44a1-b5eb-8d504e44dacb/scripts/filesaver.js"></script>

        <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.js"></script>

        <script>
          
            $(function () {
		     setTimeout(() => {
                 $('.brands .filter-group .button-wrapper a.active').click();
            }, 1500);
          
	$(document).on('click', '.text-copy', function () {
    var copiedtext = $(this).text();
    if (navigator.clipboard) {
        navigator.clipboard.writeText(copiedtext)
        .then(() => {
            $(this).prev(".copied-toast").text("Copied!").show().fadeOut(1200);
            setTimeout(() => {
                $(this).prev(".copied-toast").text("Copy Image Url");
            }, 1500);
        })
        .catch(() => {
            $(this).prev(".copied-toast").text("Copy Image Url").show().fadeOut(1200);
        });
    } else {
        $(this).prev(".copied-toast").text("Copy Image Url").show().fadeOut(1200);
    }
});

// Hover event delegation
$(document).on('mouseenter', '.copy-clip', function() {
    $(this).find(".copied-toast").show();
    $(this).parents('.each-brand').find('.brand-image-hover').addClass('svg_active');
}).on('mouseleave', '.copy-clip', function() {
    $(this).find(".copied-toast").hide();
    $(this).parents('.each-brand').find('.brand-image-hover').removeClass('svg_active');
});

	

	

	
});


        </script>
<script>
  const ACCESS_TOKEN = 'sl.u.AFhFcrJcx6-PPF4UffbhomoKRLFS4hc6Q8VobGNpBfBzPSIuIuYEXt4d8E-fmkIpi5mGhUf90uAnt4r9k31fZt6fN6Yg3t1_8EpE_aXOGQ8EvXw4W2B5YfVEddrJf_Djjp3R75rNU6yIlsx0OzLFg-GkpKwcM4q0flnA4PrRq63eOULjqBzuq5Zj7n_b1L7FRUBkRvoqDcIoFx4LG2hVbBS3aORnSk_C6Vxa5rQ27vliHnijzenP7UPgvuvBs_IVry98eWwseUhbe4R8CftXQsDtJW1-RD5UYChKrnYcoNugSF003DiuZEIvnjAFrSGpUgN3QDp-v-k9d68CrdcBRYLvFzKq05i_yEF390DxqlJHnMCeGcyP50KE7Wr2aQJODvF3OvwtIy3loo-C5xEh903ORBTLz5e-2HB6063i_QJF4YfUg1M6TlSlEW5LP1MZqBAyxlik09g-GH82cI0GoTCATefGr6jibFWwXuIKCDfbhTRQ8wVfQDF9ypod9SRoDQVl1mChOvjVQYfQcqrKV5Ms_RaLbKsHVomXBC_XB2BYR8AyVx1JPuTTB9kdNiszQc8pqrckej_pJs-unJ_JmeaoXhtmE41cazkiHnH-dHbtNo9LWg1Qm0Al_bVkquVqpHJFZrOoBfgHZ8kjfmmAhv44KsnFE2mMR8ns5J7voJM6Atklf1j2-gepGr-vWKB1q6UmeIrKODqdvK0aHfrojzf_GLCUjXhlYF7uSMGFsDxjszGXZ9d3_sIFOy2h7f-i-JUl5mx-EbEn7As5FSF13T4OR2xSLitTv4ME4nMWitCCj6s7Jskrlnhd1pIu41EW_S3CFW8YEtHRz31YWivJEbb_J8mFVg-OoVFWlQTnl3HEAJ0dEi2SylCDuXmvRlg1wH317eGXFfBZDcfg0qom4eJh7r0zm-_WVcJySYMLsLPwpVLsABmUN_y-CMcY6_Lyw35JcruiDgyhdH1OT8ZzX8C5ZDE_ZE7e-SclkatSBpOfvwZX-zkC9yO4GqDEl8GxJ5Dr3qli4Co3AdxgWN0HYXbALhDhx9NUOkiDlRlW7DwIWfuGZB6zumh3ZElIAUwHRibJcfepDmE7v5fSHaaLfPRQ5kgP47n0XNWcm8THdbfYruCd-oeK6ahulRXVaLIz5grirtN7b-9D7YGtsrzKWrD7B-J4N_0FQPLDUY_ydsRYXfuWnZx30i1-p-ht6ykFZwHm_23QPLSVZ6mzHGHm-FlcYD45boDydfYD6ZuUErv-lxpOrQ7J2ZS4FQivT754TdRbKmQLu8esIOakTu2FaC_EcPku50-zXBx-euMmOx3UDROyESQyDfqZJFNil0vP6hxWij_SxRa1X0A0wKfnSehfB1Qz-TdVKg1Bb-xrF4H0ww'; // Replace with your actual token

  // Cache object to store fetched images
  const imageCache = {};

  // Function to delay execution (for rate limiting)
  const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

  // Function to fetch files with pagination
  const fetchFilesWithPagination = async (folderPath) => {
    let hasMore = true;
    let cursor = null;
    let allFiles = [];

    try {
      while (hasMore) {
        const response = await fetch('https://api.dropboxapi.com/2/files/list_folder' + (cursor ? '/continue' : ''), {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${ACCESS_TOKEN}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(cursor ? { cursor } : { path: folderPath, limit: 200 }), // Fetch up to 200 files per request
        });

        if (!response.ok) {
          if (response.status === 429) {
            // Rate limit exceeded, wait and retry
            const retryAfter = parseInt(response.headers.get('Retry-After')) || 1000;
            console.log(`Rate limit hit. Retrying after ${retryAfter}ms`);
            await delay(retryAfter); // Wait before retrying
            continue;
          }
          throw new Error(`Error: ${response.statusText}`);
        }

        const data = await response.json();
        allFiles = allFiles.concat(data.entries); // Accumulate files
        hasMore = data.has_more;
        cursor = data.cursor; // Use the cursor for the next request

        // Add a small delay between requests to avoid hitting rate limits
        await delay(100);
      }

      return allFiles;
    } catch (error) {
      console.error('Error fetching files with pagination:', error);
      throw error;
    }
  };

  // Function to fetch temporary links in batches to avoid rate limits
  const fetchTemporaryLinks = async (files, batchSize = 100) => {
    let allFilesWithUrls = [];
    for (let i = 0; i < files.length; i += batchSize) {
      const batch = files.slice(i, i + batchSize); // Split files into smaller batches
      const filePromises = batch.map(async file => {
        try {
          const tempLinkResponse = await fetch('https://api.dropboxapi.com/2/files/get_temporary_link', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${ACCESS_TOKEN}`,
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ path: file.path_display }),
          });

          if (!tempLinkResponse.ok) {
            if (tempLinkResponse.status === 429) {
              // Rate limit exceeded, wait and retry
              const retryAfter = parseInt(tempLinkResponse.headers.get('Retry-After')) || 1000;
              console.log(`Rate limit hit. Retrying after ${retryAfter}ms`);
              await delay(retryAfter); // Wait before retrying
              return null; // Skip for now, try fetching again later
            }
            throw new Error(`Error: ${tempLinkResponse.statusText}`);
          }

          const tempLinkData = await tempLinkResponse.json();
          return { ...file, url: tempLinkData.link };
        } catch (error) {
          console.error('Error fetching temporary link:', error);
          return null;
        }
      });

      const batchWithUrls = await Promise.all(filePromises);
      allFilesWithUrls = allFilesWithUrls.concat(batchWithUrls.filter(Boolean)); // Remove null entries

      // Add a small delay between batches to avoid hitting rate limits
      await delay(500); // Adjust delay as necessary based on API limits
    }

    return allFilesWithUrls;
  };

  // Function to render files in the target div
  const renderFiles = (filesWithUrls, targetDiv) => {
    // Clear the existing content of the target div
    targetDiv.innerHTML = '';

    // Render all files at once
    filesWithUrls.forEach(file => {
      const divContent = document.createElement('div');
      divContent.classList.add('each-brand');
      divContent.innerHTML = `
        <div class="brand-image-hover">
          <img class="lazyload" src="${file.url}" data-img="${file.url}">
        </div>
        <div class="brand-form">
          <input type="checkbox" name="brand" value="${file.name}" data-url="${file.url}">
          <input type="hidden" class="data-storage" value="${file.url}" data-name="${file.name}" data-logo="${file.url}">
          <p class="name">${file.name}</p>
          <div class="copy-clip" data-link="${file.url}">
            <div class="copied-toast">Copy Image Url</div>
            <span class="text-copy">${file.url}</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"></path><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z"></path></svg>
          </div>
        </div>`;

      // Append the new content to the target div
      targetDiv.appendChild(divContent);
    });

    console.log('Images rendered in:', targetDiv);
  };

  // Function to load images for a specific folder
  const loadImagesForFolder = async (folderLocation, targetDiv) => {
    try {
      console.log(`Fetching files in folder: ${folderLocation}`);
      const folderPath = `/_Raw Logo/${folderLocation}`;

      // Check if the images are already in the cache
      if (imageCache[folderLocation]) {
        console.log('Images found in cache. Rendering from cache.');
        renderFiles(imageCache[folderLocation], targetDiv);
        return;
      }

      // Fetch all files with pagination
      const allFiles = await fetchFilesWithPagination(folderPath);

      // Filter only image files
      const files = allFiles.filter(entry => entry['.tag'] === 'file' && entry.name.match(/\.(jpg|jpeg|png|gif)$/i));
      console.log('Filtered image files:', files);

      // Fetch temporary links for all files in batches
      const filesWithUrls = await fetchTemporaryLinks(files);
      console.log('Files with temporary links:', filesWithUrls);

      // Store the fetched images in the cache
      imageCache[folderLocation] = filesWithUrls;

      // Render the files in the target div
      renderFiles(filesWithUrls, targetDiv);
    } catch (error) {
      console.error('Error fetching files in folder:', error);
    }
  };

  // Event listener for filter buttons
  document.querySelectorAll('.button-wrapper .ry-btn-primary').forEach(button => {
    button.addEventListener('click', async () => {
      const target = button.getAttribute('data-target');
      const folderLocation = button.getAttribute('data-folderlocation');
      const targetDiv = document.querySelector(target);

      if (!targetDiv) {
        console.error(`Target div not found for: ${target}`);
        return;
      }

      // Remove active class from all buttons and add to the clicked one
      document.querySelectorAll('.button-wrapper .ry-btn-primary').forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');

      // Remove active class from all containers and add to the target one
      document.querySelectorAll('.brand-box-container').forEach(container => container.classList.remove('active'));
      targetDiv.classList.add('active');

      // Load images for the selected folder
      await loadImagesForFolder(folderLocation, targetDiv);
      targetDiv.classList.remove('animated-wait');

      function removeNumberPrefixAndCapitalize(text) {
        let cleanedText = text.replace(/^\d+[-_]?/, '');
        return cleanedText.charAt(0).toUpperCase() + cleanedText.slice(1);
      }

      $('.brand-box-container .each-brand').each(function () {
        var cleanedText = removeNumberPrefixAndCapitalize($('p', this).text());
        $('p', this).text(cleanedText);

        var letter = cleanedText.charAt(0);
        var data = $(this).html();
        if (!$(this).parent().find('[data-letter="' + letter + '"]').length) {
          $(this).parent().append('<div data-results="' + letter + '" data-count="" class="brand-letter-group"><span class="headline-letter">' + letter + '</span><ul class="list" data-letter="' + letter + '"></ul></div>');

          let container = $(this).parent();
          let groups = container.find('.brand-letter-group');

          groups.sort(function (a, b) {
            return $(a).data('results').localeCompare($(b).data('results'));
          });

          groups.detach().appendTo(container);
        }
        $(this).parent().find('[data-letter="' + letter + '"]').append(this);
      });

      $('.brand-box-container .list .each-brand').wrap('<li>');
      $(".copied-toast").hide();

      initIsotope(); // Initialize Isotope after rendering

      
          $('.brand-box-container input[type="checkbox"]').prop('checked', false);
          $('.clear-all-check').hide();
          $('.brand-container .ry-flex .brand-text .count').text('0');
          $('.download.button-download').addClass('disabled');

          links = [];
      
      });
  });

  var qsRegex;
  var $grid;

  // Function to initialize Isotope
  function initIsotope() {
    $grid = $('.brand-letter-group .list').isotope({
      itemSelector: 'li',
      layoutMode: 'fitRows',
      filter: function () {
        return qsRegex ? $(this).text().match(qsRegex) : true;
      }
    });

    $('body').addClass('activated');
  }

  // Function to update filter
  function updateFilter() {
    qsRegex = new RegExp($('.search').val(), 'gi');
    $grid.isotope();

    setTimeout(function () {
      $('.brand-letter-group').each(function () {
        var finder = $(this).find('ul li:visible').length;
        $(this).attr('data-count', finder);
        setTimeout(function () {
          $grid.isotope();
        }, 100);
      });
    }, 500);
  }

  // Debounce function
  function debounce(fn, threshold) {
    var timeout;
    threshold = threshold || 100;
    return function debounced() {
      clearTimeout(timeout);
      var args = arguments;
      var _this = this;
      function delayed() {
        fn.apply(_this, args);
      }
      timeout = setTimeout(delayed, threshold);
    };
  }

  // Wait for the DOM to be ready
  $(document).ready(function () {
    setTimeout(initIsotope, 1000);

    // Search input event
    $('.search').on('keyup', debounce(updateFilter, 100));

    // MutationObserver to detect dynamically added elements
    var observer = new MutationObserver(function (mutations) {
      mutations.forEach(function (mutation) {
        if (mutation.addedNodes.length) {
          $grid.isotope('reloadItems').isotope();
        }
      });
    });

    var targetNode = document.querySelector('.brand-letter-group');
    if (targetNode) {
      observer.observe(targetNode, { childList: true, subtree: true });
    }
  });
</script>


<script>

  var links = [];
  $(function () {
    $('body').addClass('activated')
    $('.brand-box-container .each-brand').hover(function() {
        var img__hover = $(this).find('input[type="checkbox"]').attr('data-url');
        console.log(img__hover);
        $(this).find('.brand-image-hover img').attr('src', img__hover);
    });

     $('.download.button-download').addClass('disabled');
            $(document).on('click', '.brand-box-container input[type="checkbox"]', function () {
            //$('').on('click', function() {
                if ($(this).is(':checked')) {
                    $(this).removeClass().addClass('thumbChecked');
                    links.push($(this).attr('data-url'));
                    console.log(links);
                    if (links.length !== 0) {
                        $('.download').removeClass('download-disable');
                    } else {
                        $('.download').addClass('download-disable');
                    }

                } else {
                    $(this).removeClass().addClass('thumb');

                    var itemtoRemove = $(this).attr('data-url');
                    links.splice($.inArray(itemtoRemove, links), 1);
                    //console.log(links);

                    if (links.length == 0) {
                        $('.download').addClass('download-disable');
                    }
                }

                var countData = links.length;
                $('.brand-container .ry-flex .brand-text .count').text(countData);

                if (countData >= 1) { // Fixed incorrect `if (countData => 1 )`
                    $('.clear-all-check').show();
                    $('.download.button-download').removeClass('disabled');
                } else {
                    $('.clear-all-check').hide();
                    $('.download.button-download').addClass('disabled');
                }
            });

            $('.clear-all-check').click(function() {
                $('.brand-box-container input[type="checkbox"]').prop('checked', false);
                $('.clear-all-check').hide();
                $('.brand-container .ry-flex .brand-text .count').text('0');
                $('.download.button-download').addClass('disabled');
                links = [];
            });


    onAnimationFinished = function(){
      $('body').addClass('activated');
      console.log('test');
    };
    
    


    $( window ).scroll(function() {
      var height = $(window).scrollTop();

      if(height  > 300) {

        $('.brands .filter-group').addClass('fixed');
        $('.brand-container').addClass('fixed');

      }else{

        $('.brands .filter-group').removeClass('fixed');
        $('.brand-container').removeClass('fixed');
      }

    });
  });
  /*
  $(document).on('click', '.brands .filter-group .button-wrapper .ry-btn-primary', function () {
    
    var $this = $(this);
    var target = $this.attr('data-target');

    console.log("Button clicked:", $this);
    console.log("Has active class before click?", $this.hasClass('active'));

    if ($this.hasClass('active')) {
        console.log('current');
    } else {
        console.log('other');

        $('.brands .filter-group .button-wrapper .ry-btn-primary').removeClass('active');
        $('.brand-box-container').removeClass('active loaded');

        $(target).addClass('active');
        $this.addClass('active');

        $('.brand-box-container input[type="checkbox"]').prop('checked', false);

        $('.clear-all-check').hide();
        $('.brand-container .ry-flex .brand-text .count').text('0');

        $('.download.button-download').addClass('disabled');

        links = [];
    }

    console.log("Has active class after click?", $this.hasClass('active'));
});
*/

  function generateZIP() {
    console.log('TEST');
    var zip = new JSZip();
    var count = 0;
    var zipFilename = "Pictures.zip";

    links.forEach(function (url, i) {
        // Extract file extension from the URL
        var extensionMatch = url.match(/\.([a-zA-Z0-9]+)(\?|$)/);
        var extension = extensionMatch ? extensionMatch[1] : 'jpg'; // Default to jpg if no extension found
        var filename = i + '.' + extension;

        // Fetch binary content and add it to the ZIP
        JSZipUtils.getBinaryContent(url, function (err, data) {
            if (err) {
                console.error("Error downloading:", url, err);
                return;
            }
            zip.file(filename, data, { binary: true });
            count++;
            
            // Once all files are added, generate and download the ZIP
            if (count === links.length) {
                zip.generateAsync({ type: 'blob' }).then(function (content) {
                    saveAs(content, zipFilename);
                });
            }
        });
    });
}

</script>
	</body>
</html>

